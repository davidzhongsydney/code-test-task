# Code Test Challenge

## Requirement

You are required to build a microservice managing Tasks with the API endpoints for:

- Listing Tasks
- Getting a Task by its ID
- Create a Task
- Update a Task by its ID
- Remove a Task by its ID

Please use https://github.com/go-chi/chi as a router.
Please use a memory based store to make it simpler.
Tasks should have the following properties { TaskID, Name, Content, CreatedAt, UpdatedAt, DeletedAt }

## API URL Design

| Method |               URL               |       Description        |
| ------ | :-----------------------------: | :----------------------: |
| GET    |   http://localhost:8000/tasks   |      Listing Tasks       |
| GET    | http://localhost:8000/task/{id} | Getting a Task by its ID |
| POST   |   http://localhost:8000/task    |      Create a Task       |
| PUT    |   http://localhost:8000/task    | Update a Task by its ID  |
| DELETE | http://localhost:8000/task/{id} | Delete a Task by its ID  |

## JSON Example Output

#### Getting a Task by its ID

```
{
    "code": 200,
    "data": {
        "taskID": 1,
        "name": "John2",
        "content": "content2",
        "createdAt": "2023-03-22T11:34:28.4270802+11:00"
    }
}
```

```
{
    "code": 404,
    "errors": {
        "TASK_NOT_FOUND": "task does not exist"
    }
}
```

```
{
    "code": 404,
    "errors": {
        "TASK_NOT_FOUND": "task has been logically deleted"
    }
}
```

#### Create a Task

```
{
    "code": 200,
    "data": {
        "taskID": 1,
        "name": "John2",
        "content": "content2",
        "createdAt": "2023-03-22T11:34:28.4270802+11:00"
    }
}
```

#### Update a Task by its ID

```
{
    "code": 200,
    "data": {
        "taskID": 2,
        "name": "David3",
        "content": "content5",
        "createdAt": "2023-03-22T11:38:28.9628612+11:00",
        "updatedAt": "2023-03-22T11:39:02.4012817+11:00"
    }
}
```

```
{
    "code": 404,
    "errors": {
        "TASK_NOT_FOUND": "task has been logically deleted"
    }
}
```

```
{
    "code": 404,
    "errors": {
        "TASK_NOT_FOUND": "task does not exist"
    }
}
```

#### Delete a Task by its ID

```
{
    "code": 200
}
```

```
{
    "code": 404,
    "errors": {
        "TASK_NOT_FOUND": "task has been logically deleted"
    }
}
```

```
{
    "code": 404,
    "errors": {
        "TASK_NOT_FOUND": "task does not exist"
    }
}
```

#### Listing Tasks

```
{
    "code": 200,
    "data": []
}
```

```
{
    "code": 200,
    "data": [
        {
            "taskID": 5,
            "name": "John3",
            "content": "content3",
            "createdAt": "2023-03-22T11:41:45.4581712+11:00"
        },
        {
            "taskID": 2,
            "name": "David3",
            "content": "content5",
            "createdAt": "2023-03-22T11:38:28.9628612+11:00",
            "updatedAt": "2023-03-22T11:39:02.4012817+11:00"
        }
    ]
}
```

## Directory structures

```
.
├── go.mod
├── go.sum
├── Makefile
├── Dockerfile
├── README.md
├── model   // The models folder, includeing .proto files and the .go files which generated from them.
│   ├── task.go
│   ├── error_reason.proto
│   ├── error_reason.pb.go
│   └── error_reason_errors.pb.go
├── cmd    // The entry point of the app
│   └── task-server
│       ├── main.go
│       ├── main_test.go  // integration test cases (from go-chi router to memory database)
│       ├── wire.go       // wire library is for dependency injection
│       └── wire_gen.go
├── mocks      // The mocks generated by mockery used in test cases.
│   └── TaskRepo.go
├── configs     // The configuration files for local development.
│   └── config.yaml
├── utils     // The utility tools
│   └── testTool.go
└── internal    // Private code. All business logics resides in there, under "internal" directory for preventing from unwilling import.
    ├── conf    // The structure for configuration parsing, generated from .proto file
    │   ├── conf.pb.go
    │   └── conf.proto
    ├── data    // Memory database. For accessing data sources. This layer is mainly used as the encapsulation of databases, caches etc. The implementation of repo interface which defined in biz layer should be placed here.
    │   ├── data.go
    │   ├── task_test.go
    │   └── task.go
    ├── biz     // The layer for composing business logics. The interface of repo are defined in there, following the Dependence Inversion Principle.
    │   ├── biz.go
    │   ├── task_test.go
    │   └── task.go
    ├──service  // The service layer which expose the API to server. (or implement grpc API, then register in server)
    │   ├── service.go
    │   ├── task_test.go
    │   └── task.go
    ├──server  // The creation of http server (or grpc server)
    │   ├── http_handler.go
    │   ├── http_server.go
    │   ├── http_server_test.go
    │   └── server.go
    └──encoder  // The transformation from internal structure to outer structure
        ├── error_encoder.go
        ├── success_encoder.go
        └── error_enum.go

```

## Commands in Makefile

```
# Download and update dependencies
make init
# Generate files from internal folder by proto file (includes config)
make internal
# Generate files from model folder by proto file
make model
# Connect components using google wire
make wire
# Build executable file under ./bin
make build
# Generate all files
make all
```

## Docker

```bash
# build
docker build -t <your-docker-image-name> .

# run
docker run --rm -p 8000:8000 -v </path/to/your/configs>:/data/conf <your-docker-image-name>
```
